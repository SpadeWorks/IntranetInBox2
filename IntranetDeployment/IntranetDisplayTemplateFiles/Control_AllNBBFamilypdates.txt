<html xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882"> 
<head>
<title>NBB Family Updates Paging</title>

<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:TemplateHidden msdt:dt="string">0</mso:TemplateHidden>
<mso:MasterPageDescription msdt:dt="string">This is a Control Display Template with Paging. It is used by default in Rollup Pages. It allows the user to page through items using the arrows that appear when there are more items to show.</mso:MasterPageDescription>
<mso:ContentTypeId msdt:dt="string">0x0101002039C03B61C64EC4A04F5361F385106601</mso:ContentTypeId>
<mso:TargetControlType msdt:dt="string">;#Content Web Parts;#</mso:TargetControlType>
<mso:HtmlDesignAssociated msdt:dt="string">1</mso:HtmlDesignAssociated>
<mso:HtmlDesignConversionSucceeded msdt:dt="string">True</mso:HtmlDesignConversionSucceeded>
<mso:HtmlDesignStatusAndPreview msdt:dt="string">http://icsp2016dev102:8081/_catalogs/masterpage/Display%20Templates/Content%20Web%20Parts/Control_AllNBBFamilypdates.html, Conversion successful.</mso:HtmlDesignStatusAndPreview>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>

<body>

    <!--
            Warning: Do not try to add HTML to this section. Only the contents of the first <div>
            inside the <body> tag will be used while executing Display Template code. Any HTML that
            you add to this section will NOT become part of your Display Template.
    -->
    <script>
        $includeLanguageScript(this.url, "~sitecollection/_catalogs/masterpage/Display Templates/Language Files/{Locale}/CustomStrings.js");
    </script>

    <!--
        Use the div below to author your Display Template. Here are some things to keep in mind:
        * Surround any JavaScript logic as shown below using a "pound underscore" (#_ ... _#) token
        inside a comment.

        * Use the values assigned to your variables using an "underscore pound equals"
        (_#= ... =#_) token.
    -->

    <div id="Control_ListWithPaging" class="nbbmore-familyupdates">
<style type="text/css">
.nbb-RecognitionCount-tab{
	background-image: "/SiteCollectionImages/red_dot.png";
	width:36px;
	height:36px;
}
</style>

<div class="row">
						<div class="col-md-4 col-sm-4 col-xs-12">
	                        <div class="nbb-titleleftbar"></div>
                        	<div class="nbb-componenttitle">
                            	<h2>NBB Family Updates</h2>
                            </div>
                        </div>
                        <div class="col-md-8 col-sm-8 col-xs-12">
                        
                            <div class="nbb-familyupdates-tabs">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li id="All_Tab" ><a href="#all" aria-controls="all" role="tab" data-toggle="tab">All</a></li>
                                    <li id="Birthdays_Tab"><a href="#birthdays" aria-controls="birthdays" role="tab" data-toggle="tab">Birthdays</a></li>
                                    <li id="Anniversaries_Tab"  role="presentation"><a href="#Anniversaries" aria-controls="Anniversaries" role="tab"  data-toggle="tab">Anniversaries</a></li>
                                    <li id="New_Joinee_Tab"><a href="#newjoinee" aria-controls="newjoinee" role="tab" data-toggle="tab">New Joinee</a></li>
                                    <li id="Farewells_Tab"><a href="#farewells" aria-controls="farewells" role="tab" data-toggle="tab">Farewells</a></li>
                                </ul>
                            </div>
	                    </div>
                    </div>

<!--#_ 
if (!$isNull(ctx.ClientControl) &&
    !$isNull(ctx.ClientControl.shouldRenderControl) &&
    !ctx.ClientControl.shouldRenderControl())
{
    return "";
}
ctx.ListDataJSONGroupsKey = "ResultTables";
var $noResults = Srch.ContentBySearch.getControlTemplateEncodedNoResultsMessage(ctx.ClientControl);

var isRollupPageInDisplayMode = Srch.ContentBySearch.isRollupPage(ctx.ClientControl) && !Srch.U.isPageInEditMode();
var noResultsClassName = isRollupPageInDisplayMode ? "ms-attractMode ms-uppercase ms-alignCenter" : "ms-srch-result-noResults";

var ListRenderRenderWrapper = function(itemRenderResult, inCtx, tpl)
{
    var iStr = [];
    iStr.push('<li>');
    iStr.push(itemRenderResult);
    iStr.push('</li>');
    return iStr.join('');
}
ctx['ItemRenderWrapper'] = ListRenderRenderWrapper;
_#-->
    <ul class="cbs-List nbb-familyupdateslist">
      _#= ctx.RenderGroups(ctx) =#_
   </ul>
<!--#_
		 AddPostRenderCallback(ctx, function(){
		$('.nbb-recognitionProfileDetails a').click(function(event){	
			event.stopPropagation();
		});
	});
	
	

function getUrlParameter(name) {
    var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
    return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
}
	

	
		var pagingInfo = ctx.ClientControl.get_pagingInfo();
				if(!$isEmptyArray(pagingInfo)){ 	
				
_#-->
                        <ul id="Paging" class="ms-srch-Paging nbbmore-familypaging">
<!--#_ 
                        for (var i = 0; i < pagingInfo.length; i++) {
                            var pl = pagingInfo[i];
                            if(!$isNull(pl)) {
                                var imagesUrl = GetThemedImageUrl('searchresultui.png');
                                if(pl.startItem == -1) { 
                                    var selfLinkId = "SelfLink_" + pl.pageNumber;
_#-->
                                    <li id="PagingSelf"><a id="_#= $htmlEncode(selfLinkId) =#_">_#= $htmlEncode(pl.pageNumber) =#_</a></li>
<!--#_ 
                                } else if(pl.pageNumber == -1) { 
                                    var iconClass = Srch.U.isRTL() ? "ms-srch-pagingNext" : "ms-srch-pagingPrev";                                    
_#-->
                                    <li id="PagingImageLink"><a id="PageLinkPrev" href="#" class="ms-commandLink ms-promlink-button ms-promlink-button-enabled ms-verticalAlignMiddle" title="_#= $htmlEncode(pl.title) =#_" onclick="$getClientControl(this).page(_#= $htmlEncode(pl.startItem) =#_);return Srch.U.cancelEvent(event);">
                                        <span class="ms-promlink-button-image">
                                            <img src="_#= $urlHtmlEncode(imagesUrl) =#_" class="_#= $htmlEncode(iconClass) =#_" alt="_#= $htmlEncode(pl.title) =#_" />
                                        </span>
                                    </a></li>
<!--#_ 
                                } else if(pl.pageNumber == -2) { 
                                    var iconClass = Srch.U.isRTL() ? "ms-srch-pagingPrev" : "ms-srch-pagingNext";
_#-->
                                    <li id="PagingImageLink"><a id="PageLinkNext" href="#" class="ms-commandLink ms-promlink-button ms-promlink-button-enabled ms-verticalAlignMiddle" title="_#= $htmlEncode(pl.title) =#_" onclick="$getClientControl(this).page(_#= $htmlEncode(pl.startItem) =#_);return Srch.U.cancelEvent(event);">
                                        <span class="ms-promlink-button-image">
                                            <img src="_#= $urlHtmlEncode(imagesUrl) =#_" class="_#= $htmlEncode(iconClass) =#_" alt="_#= $htmlEncode(pl.title) =#_" />
                                        </span>
                                    </a></li>
<!--#_ 
                                } else { 
                                    var pageLinkId = "PageLink_" + pl.pageNumber;
_#-->
                                    <li id="PagingLink"><a id="_#= $htmlEncode(pageLinkId) =#_" href="#" title="_#= $htmlEncode(pl.title) =#_" onclick="$getClientControl(this).page(_#= $htmlEncode(pl.startItem) =#_);return Srch.U.cancelEvent(event);">_#= $htmlEncode(pl.pageNumber) =#_</a></li>
<!--#_ 
                                }
                            }
                        } 
_#-->
                        </ul>
                        
<!--#_ 
	}		
					
var id = ctx.ClientControl.get_nextUniqueId();

	var RecognizeMessageDiv= id + "_RecognizeMessageDiv";

	var itemaccountname = GetUrlKeyValue('accountname');
	itemaccountname = itemaccountname.toLowerCase();
	

	function ct_successRecognitionData() {				
		this.ct_deferred.resolve(this.ct_PersonProperties, this.ct_currentUser);			   
	}
	
	function ct_failRecognitionData(sender, args) {
	   this.ct_deferred.reject(args);
	}
	
	function ct_getValuesData(){			
		var ct_deferred = $.Deferred();
		
		var ct_PersonProperties;
		var ct_context;
		var ct_currentUser;
		
		
		// Get the current client context and PeopleManager instance.
		ct_context = new SP.context("/");
		var ct_peopleManager = new SP.UserProfiles.PeopleManager(ct_context);
		
		// Get user properties for the target user.
		// To get the PersonProperties object for the current user, use the getMyProperties method.
		ct_PersonProperties = ct_peopleManager.getPropertiesFor(itemaccountname);
		
		// Load the PersonProperties object and send the request.
		ct_context.load(ct_PersonProperties);
		
		ct_currentUser = ct_context.get_web().get_currentUser();
		ct_context.load(ct_currentUser);
		
		var ct_oRecognitionData = {ct_deferred:ct_deferred, ct_PersonProperties:ct_PersonProperties, ct_currentUser:ct_currentUser };
		ct_context.executeQueryAsync(Function.createDelegate(ct_oRecognitionData, ct_successRecognitionData), Function.createDelegate(ct_oRecognitionData, ct_failRecognitionData));
				
		
		return ct_deferred.promise();
	}
	
		
	if (ctx.ClientControl.get_shouldShowNoResultMessage() && ctx.DataProvider.get_totalRows() == 0)
	{		
_#-->
	  <div id="ErrorMsg">
      	<div class="nbb-NoResultsMessage" id="_#= RecognizeMessageDiv=#_"></div>
      </div>
<!--#_

	}
	
	AddPostRenderCallback(ctx, function(){

		$(".eqmyProfileTabs li").removeClass('eqmyTabActive');
        $(".eqmyProfileTabs li:nth-child(2)").addClass('eqmyTabActive');
        
        
        //$("#titleAnchorHref")[0].href = $(".logo-hub")[0].firstElementChild.href.split("/pages")[0] + "/Pages/IT/How Do I/How-Do-I-Recognize-a-Colleague.aspx";
        
		var Original_queryTemplate = ctx.DataProvider.get_queryTemplate();
		//alert(Original_queryTemplate);
		var queryTemplate = Original_queryTemplate.replace(/Anniversary/gi, "*");
		//alert(activeTab);
		
		if(activeTab!=undefined)
		{
			$('#'+activeTab).addClass('nbb-FamilyUpdateActiveTab');
			
			 
		}else{
			$('.nav-tabs li:first-child').addClass('nbb-FamilyUpdateActiveTab');
			
		}	
					
				
		
		$("#Anniversaries_Tab").on('click', function(){ 	
			
			var tab=Original_queryTemplate.split('STS_ListItem") ')[1];
			
			queryTemplate = Original_queryTemplate.replace(tab, "ContentType:Anniversary");
			$getClientControl(this).page("1");
			ctx.DataProvider.set_queryTemplate(queryTemplate);
			ctx.DataProvider.issueQuery();
			$('.nbb-familyupdates-tabs li').removeClass('nbb-FamilyUpdateActiveTab');
			activeTab = this.id;
			activeTabName = $('#'+ activeTab).attr('title');
		
		});
		
			$("#New_Joinee_Tab").on('click', function(){ 	
			
			var tab=Original_queryTemplate.split('STS_ListItem") ')[1];
			queryTemplate = Original_queryTemplate.replace(tab, "ContentType:New_Joinee");
			$getClientControl(this).page("1");
			ctx.DataProvider.set_queryTemplate(queryTemplate);
			ctx.DataProvider.issueQuery();
			$('.nbb-familyupdates-tabs li').removeClass('nbb-FamilyUpdateActiveTab');
			activeTab = this.id;
			activeTabName = $('#'+ activeTab).attr('title');
		
		});
		
			$("#All_Tab").on('click', function(){ 	
			
			var tab=Original_queryTemplate.split('STS_ListItem") ')[1];
			queryTemplate = Original_queryTemplate.replace(tab, "ContentType:Anniversary ContentType:Farewell ContentType:New_Joinee ContentType:Birthday");
			$getClientControl(this).page("1");
			ctx.DataProvider.set_queryTemplate(queryTemplate);
			ctx.DataProvider.issueQuery();
			$('.nbb-familyupdates-tabs li').removeClass('nbb-FamilyUpdateActiveTab');
			activeTab = this.id;
			activeTabName = $('#'+ activeTab).attr('title');
		
		});

		

	$("#Birthdays_Tab").on('click', function(){ 	
			
			var tab=Original_queryTemplate.split('STS_ListItem") ')[1];

			queryTemplate = Original_queryTemplate.replace(tab, "ContentType:Birthday");
			$getClientControl(this).page("1");
			ctx.DataProvider.set_queryTemplate(queryTemplate);
			ctx.DataProvider.issueQuery();
			$('.nbb-familyupdates-tabs li').removeClass('nbb-FamilyUpdateActiveTab');
			activeTab = this.id;
			activeTabName = $('#'+ activeTab).attr('title');
		
		});

	$("#Farewells_Tab").on('click', function(){ 	
			
			var tab=Original_queryTemplate.split('STS_ListItem") ')[1];
			
			queryTemplate = Original_queryTemplate.replace(tab, "ContentType:Farewell");
			$getClientControl(this).page("1");
			ctx.DataProvider.set_queryTemplate(queryTemplate);
			ctx.DataProvider.issueQuery();
			$('.nbb-familyupdates-tabs li').removeClass('nbb-FamilyUpdateActiveTab');
			activeTab = this.id;
			activeTabName = $('#'+ activeTab).attr('title');
		
		});

		
			 
	});
	
_#-->
          
<!--#_
if (ctx.ClientControl.get_shouldShowNoResultMessage())
{
_#-->
        <div class="_#= noResultsClassName =#_">_#= $noResults =#_</div>
<!--#_
}
_#-->

    </div>
</body>
</html>
